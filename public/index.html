<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title></title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="">
</head>

<body>
  <div>
    <h2>Get user by id</h2>
    <form id="get-user">
      <input type="text" name="id" value="1" />
      <button type="submit">Fetch</button>
    </form>
  </div>

  <div>
    <h2>Create user</h2>
    <form id="post-user">
      Username
      <input type="text" name="username" value="" />
      Password
      <input type="password" name="password" value="" />
      <button type="submit">Fetch</button>
    </form>
  </div>
</body>

<script>
  const addResponseDisplay = target => {
    const container = document.createElement('div');
    const title = document.createElement('h2');
    title.innerText = "Response:";
    const writeTo = document.createElement('div');
    container.appendChild(title);
    container.appendChild(writeTo);
    target.parentNode.appendChild(container);

    return {
      display: content => writeTo.innerHTML = content
    }
  }

  const fetchAndDisplay = (form, onSubmit) => {
    const { display } = addResponseDisplay(form);

    form.addEventListener('submit', async event => {
      event.preventDefault();
      onSubmit().then(response => response.text())
        .then(body => {
          try {
            return JSON.parse(body);
          } catch {
            throw body;
          }
        }).then(display).catch(display);
    });
  }

  const getForm = document.getElementById('get-user');
  fetchAndDisplay(getForm, () => fetch(`/user/${getForm.elements.id.value}`));

  const postForm = document.getElementById('post-user');
  fetchAndDisplay(
    postForm,
    () => {
      const { elements: { username, password } } = postForm;

      return fetch('/user', { method: 'POST', body: JSON.stringify({ username: username.value, password: password.value }) });
    }
  );
</script>

</html>